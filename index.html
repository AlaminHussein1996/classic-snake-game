<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>AL - Snake Game</title>

<link rel="icon" href="logo.png" type="image/png">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ffcc">

<style>
body{
    background:#1a1a1a;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
    color:#00ffcc;
    font-family:Arial, sans-serif;
    overflow:hidden;
}

#splash-screen{
    position:fixed;
    top:0; left:0; width:100%; height:100%;
    background:#000;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:1000;
    transition:opacity 0.8s ease;
}

.splash-logo{
    width:150px;
    border-radius:20px;
    box-shadow:0 0 25px #00ffcc;
}

.start-btn{
    margin-top:20px;
    padding:12px 35px;
    font-size:18px;
    background:#00ffcc;
    color:#000;
    border:none;
    border-radius:30px;
    font-weight:bold;
    cursor:pointer;
    box-shadow:0 0 15px #00ffcc;
}

canvas{
    border:5px solid #333;
    background:#000;
    max-width:90vw;
}

.controls{
    display:grid;
    grid-template-columns:repeat(3,70px);
    gap:15px;
    margin-top:20px;
}

.btn{
    width:70px; height:70px;
    background:#222;
    border:2px solid #00ffcc;
    color:#00ffcc;
    font-size:30px;
    display:flex;
    align-items:center;
    justify-content:center;
    border-radius:50%;
}
</style>
</head>

<body>

<div id="splash-screen">
    <img src="logo.png" class="splash-logo">
    <h2>AL GAMING</h2>

    <div id="permission-section" style="display:none;">
        <p>গেম চালাতে অনুমতি প্রয়োজন</p>
        <button class="start-btn" onclick="requestPermission()">অনুমতি দিন</button>
    </div>

    <div id="enter-section" style="display:none;">
        <button class="start-btn" onclick="enterGame()">প্রবেশ করুন</button>
    </div>
</div>

<div style="margin-bottom:10px;">
স্কোর: <span id="score">0</span> |
সেরা: <span id="highScore">0</span>
</div>

<canvas id="gameCanvas" width="400" height="400"></canvas>

<div class="controls">
    <div></div><div class="btn" onclick="changeDirection('UP')">▲</div><div></div>
    <div class="btn" onclick="changeDirection('LEFT')">◀</div>
    <div class="btn" onclick="changeDirection('DOWN')">▼</div>
    <div class="btn" onclick="changeDirection('RIGHT')">▶</div>
</div>

<script>

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let box = 20;
let snake, food, score, highScore, d, game;

// Load High Score
highScore = localStorage.getItem("snakeHS") || 0;
document.getElementById("highScore").innerHTML = highScore;

// Splash Flow
window.onload = function(){
    setTimeout(()=>{
        document.getElementById("permission-section").style.display="block";
    },1500);
};

function requestPermission(){
    document.getElementById("permission-section").style.display="none";
    document.getElementById("enter-section").style.display="block";
}

function enterGame(){
    document.getElementById("splash-screen").style.opacity="0";
    setTimeout(()=>{
        document.getElementById("splash-screen").style.display="none";
        startGame();
    },800);
}

function startGame(){
    snake = [{x:9*box, y:10*box}];
    food = randomFood();
    score = 0;
    d = "";
    document.getElementById("score").innerHTML = score;
    clearInterval(game);
    game = setInterval(draw,200);
}

function randomFood(){
    return {
        x: Math.floor(Math.random()*(canvas.width/box))*box,
        y: Math.floor(Math.random()*(canvas.height/box))*box
    };
}

function changeDirection(dir){
    if(dir==="LEFT" && d!=="RIGHT") d="LEFT";
    else if(dir==="UP" && d!=="DOWN") d="UP";
    else if(dir==="RIGHT" && d!=="LEFT") d="RIGHT";
    else if(dir==="DOWN" && d!=="UP") d="DOWN";
}

document.addEventListener("keydown", function(e){
    if(e.key==="ArrowLeft") changeDirection("LEFT");
    else if(e.key==="ArrowUp") changeDirection("UP");
    else if(e.key==="ArrowRight") changeDirection("RIGHT");
    else if(e.key==="ArrowDown") changeDirection("DOWN");
});

function draw(){
    ctx.fillStyle="black";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    for(let i=0;i<snake.length;i++){
        ctx.fillStyle = (i===0) ? "#00ffcc" : "#008866";
        ctx.fillRect(snake[i].x, snake[i].y, box-2, box-2);
    }

    ctx.fillStyle="red";
    ctx.fillRect(food.x, food.y, box, box);

    let sX = snake[0].x;
    let sY = snake[0].y;

    if(d==="LEFT") sX -= box;
    if(d==="UP") sY -= box;
    if(d==="RIGHT") sX += box;
    if(d==="DOWN") sY += box;

    if(sX===food.x && sY===food.y){
        score++;
        document.getElementById("score").innerHTML = score;

        if(score > highScore){
            highScore = score;
            localStorage.setItem("snakeHS", highScore);
            document.getElementById("highScore").innerHTML = highScore;
        }
        food = randomFood();
    } else {
        snake.pop();
    }

    const newHead = {x:sX, y:sY};

    if(sX<0 || sX>=canvas.width || sY<0 || sY>=canvas.height || collision(newHead,snake)){
        clearInterval(game);
        setTimeout(()=>{
            alert("গেম ওভার! স্কোর: "+score);
            startGame();
        },100);
        return;
    }

    snake.unshift(newHead);
}

function collision(head,array){
    return array.some(segment => segment.x===head.x && segment.y===head.y);
}

</script>

</body>
</html>
